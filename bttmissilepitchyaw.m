%% BTT Missile, Pitch/Yaw Channel
clear all; close all;

%TABLE 11.2
a1  = [1.593 1.485 1.269 1.130 0.896 0.559 0.398];
a1p = [0.285 0.192 0.147 0.118 0.069 0.055 0.043];
a2  = [260.559 266.415 196.737 137.385 129.201 66.338 51.003];
a3  = [185.488 182.532 176.932 160.894 138.591 78.404 53.840];
a4  = [1.506 1.295 1.169 1.130 1.061 0.599 0.421];
a5  = [0.298 0.243 0.217 0.191 0.165 0.105 0.078];
b1  = [1.655 1.502 1.269 1.130 0.896 0.559 0.398];
b1p = [0.295 0.195 0.147 0.118 0.069 0.055 0.043];
b2  = [39.988 -24.627 -31.452 -41.425 -68.165 -21.448 -9.635];
b3  = [159.974 170.532 182.030 184.093 154.608 89.853 59.587];
b4  = [0.771 0.652 0.680 0.691 0.709 0.360 0.243];
b5  = [0.254 0.191 0.188 0.182 0.162 0.102 0.072];

jxjyjz = 0.7501;
Jx = 1;
Jy = .25;
Jz = 1;
g = 9.8;
V = 1401;
omega_x = 10;

for i = 1:length(a1)
    A11(:,:,i) = [a1p(i)-a1(i) -a1p(i)*a4(i)-a2(i); 1 -a4(i)];
    A22(:,:,i) = [-b1(i)-b1p(i) b1p(i)*b4(i)-b2(i); 1 -b4(i)];
    A12(:,:,i) = omega_x/57.3*[(Jx-Jy)/Jz -a1p(i); 0 -1];
    A21(:,:,i) = omega_x/57.3*[(Jz-Jx)/Jy -b1p(i); 0 1];
    A(:,:,i) = [A11(:,:,i) A12(:,:,i); A21(:,:,i) A22(:,:,i)];
    B(:,:,i) = [-a1p(i)*a5(i) 0; -a5(i) 0; 0 b1p(i)*b5(i)-b3(i); 0 -b5(i)];
    C(:,:,i) = V/(57.3*g)*[0 0 0 -b4(i); 0 a4(i) 0 0];
    D(:,:,i) = V/(57.3*g)*[0 -b5(i); a5(i) 0];
end

yalmip('clear');
P = sdpvar(4);
W = sdpvar(2,4);
eta = .0001;
Const = [];
Const = [Const; P>=eta*eye(size(P))];
for i = 1:length(a1)
    mat = A(:,:,i)*P+B(:,:,i)*W+P*A(:,:,i)'+W'*B(:,:,i)';
    Const = [Const; mat <= -eta*eye(4)];
end
opt=sdpsettings('solver','sedumi','verbose',0);
optimize(Const, [], opt);